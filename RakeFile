require 'rubygems'
require 'cucumber'
require 'cucumber/rake/task'

def options_for(config_file: ENV["env"] || "default", page_dir:"default", data_suite:"default", url: "default")
  "FIG_NEWTON_FILE=#{config_file}.yml page_dir=#{page_dir} data_suite=#{data_suite} url=#{url}"
end


def create_profile(profile_name, options)
  Cucumber::Rake::Task.new(profile_name) do |t|
    t.profile = "#{profile_name}"
    t.cucumber_opts = options
  end
end

namespace :test do
  create_profile(:functional  ,    options_for(url: "stubbed"))
  create_profile(:integration ,    options_for)
  create_profile(:tags        , "#{options_for} --tags #{ENV["tags"]}")

  namespace :mobile do
    create_profile(:functional  ,    options_for(page_dir: "mobile", data_suite: "mobile", url: "stubbed"))
    create_profile(:integration ,    options_for(page_dir: "mobile", data_suite: "mobile"))
    create_profile(:tags        , "#{options_for(page_dir: "mobile", data_suite: "mobile")} --tags #{ENV["tags"]}")

    multitask :all => ["test:mobile:integration", :"test:mobile:functional"]
  end

  multitask :all => ["test:integration", :"test:functional"]
end

task(:default => ["test:all", "test:mobile:all"])

